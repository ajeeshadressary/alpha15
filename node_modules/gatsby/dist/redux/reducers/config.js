"use strict";

var _extends2 = require("babel-runtime/helpers/extends");

var _extends3 = _interopRequireDefault(_extends2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Joi = require("joi");
var chalk = require("chalk");

var _require = require("../../joi-schemas/joi"),
    gatsbyConfigSchema = _require.gatsbyConfigSchema;

module.exports = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var action = arguments[1];

  switch (action.type) {
    case "SET_SITE_CONFIG":
      // Validate the config.
      var result = Joi.validate(action.payload, gatsbyConfigSchema);
      // TODO use Redux for capturing errors from different
      // parts of Gatsby so a) can capture richer errors and b) be
      // more flexible how to display them.
      if (result.error) {
        console.log(chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`));
        console.log(chalk.bold.red(result.error));
        console.log(config);
        throw new Error(`The site's gatsby-config.js failed validation`);
        return;
      }
      return (0, _extends3.default)({}, action.payload);
    default:
      return state;
  }
};